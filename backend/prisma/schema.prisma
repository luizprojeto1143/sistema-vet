// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ------------------------------------------------------
// 1. TENANT MANAGEMENT & CONFIG
// ------------------------------------------------------

model Clinic {
  id            String   @id @default(uuid())
  name          String
  cnpj          String?  @unique
  address       String?
  phone         String?
  email         String?
  logoUrl       String?
  operatingHours String? // JSON Stringified: { monday: { start: '09:00', end: '18:00', closed: false }, ... }
  
  // Module Flags (Config)
  hasPetshop    Boolean  @default(false)
  hasHomeCare   Boolean  @default(false)
  hasInternment Boolean  @default(true)
  hasFiscal     Boolean  @default(false)
  hasAnalisaVet Boolean  @default(false)
  hasTelemedicine Boolean @default(false)

  // SaaS Fees
  platformFeeRate     Float   @default(5.0) // Standard 5%
  acceptedHardwareOffer Boolean @default(false)
  promotionalRateEndsAt DateTime?

  // Configuration
  internmentDailyRate Decimal @default(150.00)

  // Subscription / Plan
  planId        String?
  plan          Plan?    @relation(fields: [planId], references: [id])
  planStatus    String?  // ACTIVE, SUSPENDED

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  users         User[]
  pets          Pet[]
  tutors        Tutor[]
  services      Service[]
  products      Product[]
  appointments  Appointment[]
  internments   Internment[]
  financialTransactions FinancialTransaction[]
  stockMovements      StockMovement[]
  documentTemplates   DocumentTemplate[]
  referralRewards     ReferralReward[]
  commissionRules     CommissionRule[] 
  productKits         ProductKit[] // Kit relation
  notifications       Notification[] 
  
  // Ledger
  // Ledger
  ledgerAccounts      LedgerAccount[]
  ledgerEntries       LedgerEntry[]

  // Fiscal
  invoices            Invoice[]

  // Missing Relations Fixed
  roles               Role[]
  commissionLogs      CommissionLog[]
  
  // Growth / Referrals (B2B)
  referralCode   String?  @unique
  saasCredits    Int      @default(0) // Months of free SaaS
  
  referredById   String?
  referredBy     Clinic?  @relation("ClinicReferral", fields: [referredById], references: [id])
  referrals      Clinic[] @relation("ClinicReferral")
}

// ------------------------------------------------------
// 2. USER MANAGEMENT & ROLES
// ------------------------------------------------------

// Enum removed for SQLite compatibility
// UserRole: ADMIN, VET, AUXILIARY, RECEPTION, STOCK, FINANCIAL, TUTOR

model Role {
  id          String   @id @default(uuid())
  name        String   // "Gerente", "Recepcionista Senior"
  description String?
  
  isSystem    Boolean  @default(false) // If true, cannot be deleted (e.g. Admin, Vet)
  
  permissions String   // JSON Array: ["stock.view", "finance.edit"]
  
  clinicId    String
  clinic      Clinic   @relation(fields: [clinicId], references: [id])
  
  users       User[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  passwordHash  String?
  fullName      String
  cpf           String?  @unique
  phone         String?
  photoUrl      String? // For Profile

  // Role Management
  role          String?  // Legacy/System Role Enum (ADMIN, VET...) - Optional now
  roleId        String?
  customRole    Role?    @relation(fields: [roleId], references: [id])
  
  // Professional Details (For Vets/Staff)
  crmv          String?
  pixKeyType    String? // CPF, EMAIL, PHONE, RANDOM
  pixKey        String? 
  commissionRate Float?  // Default commission %
  
  // Finance / Split
  mpRecipientId String?  // Mercado Pago Account ID for direct split
  
  // Permissions (JSON stringified) - Overrides
  permissions   String?    

  clinicId      String?
  clinic        Clinic?  @relation(fields: [clinicId], references: [id])

  // Relations
  tutorProfile  Tutor?   // If this user is also a Tutor linked to pets
  
  appointments  Appointment[] // As professional
  prescriptions Prescription[] // As prescriber
  vaccineRecords VaccineRecord[] // As vet
  auditLogs     AuditLog[]
  internmentLogs InternmentLog[]
  
  commissionRules CommissionRule[] // Rules defined for this provider
  commissionLogs  CommissionLog[]  // History of earnings
  recordAmendments RecordAmendment[]
  // Relations Fixed
  medicalRecords MedicalRecord[] // As Vet associated with record
  medicationExecutions MedicationExecution[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// ------------------------------------------------------
// 3. PATIENTS (PETS) & TUTORS
// ------------------------------------------------------

model Tutor {
  id            String   @id @default(uuid())
  fullName      String
  cpf           String?
  phone         String
  email         String?
  address       String?
  
  // Link to User Login (Optional, created when they register on App)
  userId        String?  @unique
  user          User?    @relation(fields: [userId], references: [id])

  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])

  pets          Pet[]
  invoices      FinancialTransaction[]
  fiscalInvoices Invoice[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Growth / Referrals (B2C)
  referralCode  String?  @unique
  
  referredById  String?
  referredBy    Tutor?   @relation("TutorReferral", fields: [referredById], references: [id])
  referrals     Tutor[]  @relation("TutorReferral")
}

model Pet {
  id            String   @id @default(uuid())
  name          String
  species       String   // DOG, CAT, BIRD, EXOTIC
  breed         String?
  gender        String?  // MALE, FEMALE
  isCastrated   Boolean  @default(false)
  birthDate     DateTime?
  weight        Float?
  
  photoUrl      String?
  allergies     String? // Free text, highlighted in red
  chronicConditions String?

  tutorId       String
  tutor         Tutor    @relation(fields: [tutorId], references: [id])

  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])

  medicalRecords MedicalRecord[]
  internments    Internment[]
  appointments   Appointment[]
  vaccines       VaccineRecord[]
  packages       PetPackage[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}



model ProductBatch {
  id            String   @id @default(uuid())
  batchNumber   String
  expirationDate DateTime
  
  quantity      Decimal
  
  productId     String
  product       Product  @relation(fields: [productId], references: [id])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model VaccineRecord {
  id            String   @id @default(uuid())
  name          String
  batch         String?
  applicationDate DateTime @default(now())
  nextDueDate   DateTime?
  
  petId         String
  pet           Pet      @relation(fields: [petId], references: [id])
  
  vetId         String?   
  vet           User?     @relation(fields: [vetId], references: [id])

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

}



model PetPackage {
  id            String   @id @default(uuid())
  name          String
  totalSessions Int
  usedSessions  Int      @default(0)
  price         Decimal
  type          String   // BATH, TOSA, DAYCARE
  
  petId         String
  pet           Pet      @relation(fields: [petId], references: [id])
  
  // Relations: Removed duplicate relation definition if present, ensuring clear single link
  active        Boolean  @default(true)
  createdAt     DateTime @default(now())
}

// ------------------------------------------------------
// 4. SERVICES & APPOINTMENTS (AGENDA)
// ------------------------------------------------------

model Service {
  id            String   @id @default(uuid())
  name          String
  shortCode     String?  // CONS, VAC, SURG
  price         Decimal
  durationMin   Int      @default(30)
  
  type          String   // CONSULTATION, SURGERY, VACCINE, BATH, HOME_CARE
  allowParallel Boolean  @default(false) // For Vaccines (can have multiple in same slot)
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])

  appointments  Appointment[]
  
  commissionRules CommissionRule[]
}

model Appointment {
  id            String   @id @default(uuid())
  date          DateTime
  
  status        String   // SCHEDULED, CONFIRMED, IN_PROGRESS, COMPLETED, MISSED, CANCELED
  type          String   // CONSULTATION, RETURNING, VACCINE, etc.
  
  notes         String?

  serviceId     String?
  service       Service? @relation(fields: [serviceId], references: [id])

  petId         String
  pet           Pet      @relation(fields: [petId], references: [id])

  tutorId       String?  // Denormalized for query speed
  
  vetId         String?
  vet           User?    @relation(fields: [vetId], references: [id])

  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])

  preConsultation String? // Syntons, evolution from Tutor App

  // Link to generated Medical Record
  medicalRecord MedicalRecord?

  createdAt     DateTime @default(now())
}

// ------------------------------------------------------
// 5. MEDICAL RECORD (PRONTUÁRIO) & ANALISAVET
// ------------------------------------------------------

model MedicalRecord {
  id            String   @id @default(uuid())
  
  anamnesis     String?
  
  // Physical Exam Structured
  physicalExam  String? // General notes
  temperature   Float?
  mucosa        String?
  painLevel     String? // LOW, MEDIUM, HIGH
  
  diagnosis     String?
  treatment     String?

  // Links
  appointmentId String? @unique
  appointment   Appointment? @relation(fields: [appointmentId], references: [id])

  petId         String
  pet           Pet      @relation(fields: [petId], references: [id])

  vetId         String
  // vet relation fixed below (User)
  vet           User     @relation(fields: [vetId], references: [id])
  
  exams         Exam[]
  prescriptions Prescription[]
  documents     SignedDocument[]

  createdAt     DateTime @default(now())
  
  // Consumption & Billing
  consumedItems String?  // JSON: [{ productId, name, quantity, price }]

  // Locking & Integrity
  locked        Boolean  @default(false)
  lockedAt      DateTime?
  amendments    RecordAmendment[]
}

model RecordAmendment {
  id            String   @id @default(uuid())
  content       String   // The additional note
  reason        String?
  
  medicalRecordId String
  medicalRecord   MedicalRecord @relation(fields: [medicalRecordId], references: [id])
  
  authorId      String
  author        User     @relation(fields: [authorId], references: [id])
  
  createdAt     DateTime @default(now())
}

model Prescription {
  id              String   @id @default(uuid())
  medicationName  String
  dosage          String
  frequency       String
  duration        String
  instructions    String?
  
  medicalRecordId String?
  medicalRecord   MedicalRecord? @relation(fields: [medicalRecordId], references: [id])

  internmentId    String? 
  internment      Internment? @relation(fields: [internmentId], references: [id])

  prescribedById  String
  prescribedBy    User      @relation(fields: [prescribedById], references: [id])

  // Stock Integration
  productId       String?
  product         Product?  @relation(fields: [productId], references: [id])

  executions      MedicationExecution[]
}

model MedicationExecution {
  id             String   @id @default(uuid())
  executedAt     DateTime @default(now())
  
  prescriptionId String
  prescription   Prescription @relation(fields: [prescriptionId], references: [id])

  executedById   String
  // executedBy relation fixed below (User)
  executedBy     User     @relation(fields: [executedById], references: [id])

  notes          String?
}

model Exam {
  id            String   @id @default(uuid())
  name          String
  status        String   // REQUESTED, COMPLETED
  
  resultData    String?  // Structured result fields (JSON stringified)
  fileUrl       String?  // PDF/Image
  
  analysisSummary String? // From AnalisaVet (AI Insight)

  medicalRecordId String
  medicalRecord   MedicalRecord @relation(fields: [medicalRecordId], references: [id])
}

// ------------------------------------------------------
// 6. INTERNMENT (HOSPITAL)
// ------------------------------------------------------

model Internment {
  id            String   @id @default(uuid())
  entryDate     DateTime
  exitDate      DateTime?
  status        String   // ACTIVE, DISCHARGED
  reason        String
  
  bedNumber     Int?

  petId         String
  pet           Pet      @relation(fields: [petId], references: [id])

  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])

  logs          InternmentLog[] // Daily evolution logs
  prescriptions Prescription[] // Medications to be administered during stay
  vitalSigns    VitalSign[]
  dailyRecords  DailyRecord[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model DailyRecord {
  id            String   @id @default(uuid())
  date          DateTime @default(now())
  
  // Checks
  feed          Boolean  @default(false)
  water         Boolean  @default(false)
  urine         Boolean  @default(false)
  feces         Boolean  @default(false)
  
  humor         String?  // ANIMATED, DEPRRESSED, AGGRESSIVE
  notes         String?  // Clinical evolution
  
  internmentId  String
  // internment relation fixed below (Internment)
  internment    Internment @relation(fields: [internmentId], references: [id])
}

model VitalSign {
  id            String   @id @default(uuid())
  dateTime      DateTime @default(now())
  
  temperature   Float?
  heartRate     Int?     // BPM
  respiratoryRate Int?   // MPM
  tpc           String?  // Secs
  
  internmentId  String
  internment    Internment @relation(fields: [internmentId], references: [id])
  
  recordedById  String?
}

// ------------------------------------------------------
// 7. INVENTORY (PRODUCTS)
// ------------------------------------------------------

model Product {
  id            String   @id @default(uuid())
  name          String
  category      String   // MEDICINE, FOOD, SUPPLY, TOY, CLOTHING
  barcode       String?  // EAN/GTIN
  sku           String?  // Internal Code
  
  controlType   String   @default("UN") // UNIT, ML, KG
  totalVolumeMl Float?   // If ML/KG, content per unit
  
  usageType     String   @default("BOTH") // INTERNAL, SALE, BOTH
  
  currentStock  Decimal  @default(0) // Decimal for fractional
  minStock      Decimal  @default(5)
  
  costPrice     Decimal
  salePrice     Decimal
  
  // Fiscal Data
  ncm           String?
  cfop          String?
  taxRule       String?  // Reference to TaxProfile rule
  
  boosterIntervalDays Int? 
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])

  stockMovements StockMovement[]
  prescriptions  Prescription[] // Linked Prescriptions

  createdAt     DateTime @default(now())
  kitItems       ProductKitItem[] 
  batches        ProductBatch[]

  updatedAt     DateTime @updatedAt
}

model ProductKit {
  id            String   @id @default(uuid())
  name          String
  description   String?
  
  items         ProductKitItem[]
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  createdAt     DateTime @default(now())
}

model ProductKitItem {
  id            String   @id @default(uuid())
  quantity      Decimal
  
  productId     String
  product       Product  @relation(fields: [productId], references: [id])
  
  kitId         String
  kit           ProductKit @relation(fields: [kitId], references: [id])
}

// ------------------------------------------------------
// 8. FINANCE & DOCUMENTS
// ------------------------------------------------------

model FinancialTransaction {
  id            String   @id @default(uuid())
  type          String   // INCOME, EXPENSE
  amount        Decimal
  transactionId String? // External ID (MP)
  status        String   // COMPLETED, PENDING, FAILED, CANCELED
  
  // Split Logic
  platformFee   Decimal? @default(0.00) // Amount capable of being split
  netAmount     Decimal? // Amount received by clinic
  splitStatus   String?  // PENDING, PROCESSED
  
  paymentMethod String?  // PIX, CARD, CASH, SPLIT
  
  category      String?  
  
  tutorId       String?
  tutor         Tutor?   @relation(fields: [tutorId], references: [id])
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  ledgerEntries LedgerEntry[]
  invoice       Invoice?
  
  createdAt     DateTime @default(now())
}

model DocumentTemplate {
  id            String   @id @default(uuid())
  name          String
  content       String?  // HTML or Text content
  fileUrl       String?  // PDF Template
  
  triggerType   String?  // SURGERY, INTERNMENT
  requiresSign  Boolean  @default(true)

  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
}

model SignedDocument {
  id            String   @id @default(uuid())
  signedAt      DateTime @default(now())
  fileUrl       String   // Signed PDF
  
  medicalRecordId String?
  medicalRecord   MedicalRecord? @relation(fields: [medicalRecordId], references: [id])
}

// ------------------------------------------------------
// 9. AUDIT
// ------------------------------------------------------

model AuditLog {
  id            String   @id @default(uuid())
  action        String
  details       String?
  
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  
  createdAt     DateTime @default(now())
}

model StockMovement {
  id            String   @id @default(uuid())
  type          String   // IN, OUT, ADJUSTMENT
  quantity      Decimal
  reason        String?
  
  productId     String
  product       Product  @relation(fields: [productId], references: [id])
  
  batchId       String?  // Traceability
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  createdAt     DateTime @default(now())
}

model InternmentLog {
  id            String   @id @default(uuid())
  date          DateTime @default(now())
  description   String
  type          String   // CLINICAL, FEEDING, MEDICATION
  
  internmentId  String
  internment    Internment @relation(fields: [internmentId], references: [id])
  
  authorId      String?
  author        User?    @relation(fields: [authorId], references: [id])
}

// ------------------------------------------------------
// 10. SAAS CORE (MODULE 0)
// ------------------------------------------------------

model Notification {
  id            String   @id @default(uuid())
  title         String
  message       String
  type          String   // ALERT, INFO, SUCCESS, WARNING
  read          Boolean  @default(false)
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  createdAt     DateTime @default(now())
}

model Plan {
  id          String   @id @default(uuid())
  name        String   // "Parceiro 5%", "Enterprise Fixo"
  description String?
  
  // Billing Configuration
  billingType String   // PERCENTAGE, FIXED
  percentage  Float?   // e.g., 5.0
  fixedPrice  Decimal? // e.g., 199.00
  
  // Limits / Features
  maxUsers       Int     @default(5)
  maxStorageMb   Int     @default(1000)
  
  allowTelemedicine Boolean @default(false)
  allowAi           Boolean @default(false)
  
  clinics     Clinic[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SaasConfig {
  id          String   @id @default("global") // Singleton
  
  enableByok        Boolean @default(true)
  globalMaintenance Boolean @default(false)
  
  termsOfService    String?
  privacyPolicy     String?
  
  minAppVersionIOS     String?
  minAppVersionAndroid String?
  
  updatedAt   DateTime @updatedAt
}

model SupportAccessLog {
  id          String   @id @default(uuid())
  
  supportUserId String // ID of the SaaS Owner/Support who accessed
  targetClinicId String
  reason        String
  
  startedAt     DateTime @default(now())
  endedAt       DateTime?
}

// ------------------------------------------------------
// 11. GROWTH ENGINE (REFERRALS)
// ------------------------------------------------------

model ReferralReward {
  id            String   @id @default(uuid())
  name          String   // "Indicou Ganhou - Vacina"
  description   String?
  
  programType   String   // B2C_TUTOR
  
  triggerType   String   // FIRST_APPOINTMENT, FIRST_PURCHASE
  
  rewardType    String   // DISCOUNT_FIXED, DISCOUNT_PERCENT, FREE_SERVICE
  rewardValue   Decimal? // e.g. 10.00 or 15.0
  serviceId     String?  // If FREE_SERVICE
  
  active        Boolean  @default(true)
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  createdAt     DateTime @default(now())
}

// ------------------------------------------------------
// 12. FINANCE AUTOMATION (PROVIDER RULES)
// ------------------------------------------------------

model CommissionRule {
  id            String   @id @default(uuid())
  
  name          String?  // Optional alias, e.g. "Anestesia Dr. House"
  
  providerId    String
  provider      User     @relation(fields: [providerId], references: [id])
  
  serviceId     String
  service       Service  @relation(fields: [serviceId], references: [id])
  
  // Rule Logic
  ruleType      String   // FIXED_PROVIDER_VALUE, PERCENTAGE_CLINIC_MARGIN
  
  // If ruleType = FIXED_PROVIDER_VALUE
  // e.g., Provider charges 300.00 fixed. Clinic charges client whatever (e.g. 500).
  providerFixedValue Decimal? 
  
  // If ruleType = PERCENTAGE_CLINIC_MARGIN
  // e.g., Clinic keeps 20%. Provider gets 80%.
  clinicMarginPercent Float? 
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  updatedAt     DateTime @updatedAt
}

model CommissionLog {
  id            String   @id @default(uuid())
  
  providerId    String
  provider      User     @relation(fields: [providerId], references: [id])
  
  // The service performed
  serviceName   String
  salePrice     Decimal
  
  // The split calculation
  providerAmount Decimal
  clinicAmount   Decimal
  
  status        String   @default("PENDING") // PENDING, PAID, CANCELED
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  createdAt     DateTime @default(now())
  paidAt        DateTime?
}

// ------------------------------------------------------
// 13. ACCOUNTING LEDGER (DOUBLE ENTRY)
// ------------------------------------------------------

model LedgerAccount {
  id            String   @id @default(uuid())
  name          String   // e.g. "Caixa Geral", "Contas a Receber", "Receita de Serviços"
  code          String?  // Plan of Accounts code: 1.1.1, 4.1.1
  type          String   // ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE
  
  balance       Decimal  @default(0) // Cached balance
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  entriesFrom   LedgerEntry[] @relation("DebitAccount")
  entriesTo     LedgerEntry[] @relation("CreditAccount")
  
  createdAt     DateTime @default(now())
}

model LedgerEntry {
  id            String   @id @default(uuid())
  description   String
  amount        Decimal
  
  transactionDate DateTime @default(now())
  
  debitAccountId String
  debitAccount   LedgerAccount @relation("DebitAccount", fields: [debitAccountId], references: [id])
  
  creditAccountId String
  creditAccount   LedgerAccount @relation("CreditAccount", fields: [creditAccountId], references: [id])
  
  // Link to operational transaction
  financialTransactionId String?
  financialTransaction   FinancialTransaction? @relation(fields: [financialTransactionId], references: [id])
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  createdAt     DateTime @default(now())
}

// ------------------------------------------------------
// 14. FISCAL (NF-e / NFS-e)
// ------------------------------------------------------

model Invoice {
  id            String   @id @default(uuid())
  
  // Header
  number        Int?     // Número da Nota
  series        Int?     // Série
  type          String   // NFSe (Service) or NFe (Product)
  status        String   // DRAFT, TRANSMITTED, AUTHORIZED, REJECTED, CANCELED
  
  // Keys
  accessKey     String?  // Chave de Acesso (44 chars)
  protocol      String?  // Protocolo de Autorização
  
  // Data
  issuedAt      DateTime?
  xmlContent    String?  // The signed XML
  pdfUrl        String?  // Link to stored PDF
  
  // Values
  totalAmount   Decimal
  taxAmount     Decimal?
  
  // Relations
  financialTransactionId String? @unique
  financialTransaction   FinancialTransaction? @relation(fields: [financialTransactionId], references: [id])
  
  tutorId       String
  tutor         Tutor    @relation(fields: [tutorId], references: [id])
  
  clinicId      String
  clinic        Clinic   @relation(fields: [clinicId], references: [id])
  
  items         InvoiceItem[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model InvoiceItem {
  id            String   @id @default(uuid())
  description   String
  code          String?  // Service Code (LC116) or NCM
  
  quantity      Decimal
  unitPrice     Decimal
  totalPrice    Decimal
  
  taxRule       String?  // ISS, ICMS details (JSON)
  
  invoiceId     String
  invoice       Invoice  @relation(fields: [invoiceId], references: [id])
}


